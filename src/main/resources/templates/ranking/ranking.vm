<style type="text/css">
	.helpful {
		display: block;
	}
	
    .helpful a img {
        border: none;
    }

    .helpful .feedback {
        border: 1px solid;
        padding: 10px 10px 10px 10px;
        margin: 0px 8%;
        margin-top: 10px;
    }

    .helpful a {
		text-decoration: none;	
    }

	.helpful a.button {
		background-color: #ECECEC;
		border: 1px solid #CACACA;
		border-bottom-left-radius: 3px 3px;
		border-bottom-right-radius: 3px 3px;
		border-top-left-radius: 3px 3px;
		border-top-right-radius: 3px 3px;
		display: block;
		padding: 4px 5px;	
		float: left;
		cursor: pointer;
		line-height: 1.2;
		font-size: 11px;
	}
	
	.helpful a.button:hover {
		background-color: #DADADA;
	}

	.helpful a.button.toggled {
		background-color: #CCCCCC;
		border-color: #AAAAAA;
	}
	
	.helpful a .liketext {
		color: #333333;
		display: block;
		padding-left: 17px;		
		background: url($bootstrap.domainName/download/resources/com.unic.confluence.like/like.png) no-repeat 0% -2px;
	}
	
	.helpful a .disliketext {
		color: #333333;
		display: block;
		padding-left: 15px;		
		background: url($bootstrap.domainName/download/resources/com.unic.confluence.like/dislike.png) no-repeat 0% -2px;
	}

	.helpful a.button.toggled .liketext {
		background: url($bootstrap.domainName/download/resources/com.unic.confluence.like/likegrey.png) no-repeat 0% -2px;
	}
	
	.helpful a.button.toggled .disliketext {
		background: url($bootstrap.domainName/download/resources/com.unic.confluence.like/dislikegrey.png) no-repeat 0% -2px;
	}
</style>

<div class="helpful">
	<table>
		<tr>
		    <td><a  class="button #if($hasLiked)toggled#end" href="$req.contextPath/statpro-ranking/rankMe.action?pageId=$pageId&amp;#if($hasLiked)like=true&amp;dislike=true#{else}like=true&amp;dislike=false#end"><span class="liketext">Like</span></a>
			</td>
			<td><a class="button #if($hasDisliked)toggled#end" href="$req.contextPath/statpro-ranking/rankMe.action?pageId=$pageId&amp;#if($hasDisliked)like=true&amp;dislike=true#{else}like=false&amp;dislike=true#end"><span class="disliketext">&nbsp;</span></a></td>
			#if (!$hasLiked)
    		<td>&nbsp;<a id="likeUserTip" href="#" title="Click to expand">$likeCount</a><span id="likeUserList" style="display: none">$likeUserList</span> of your peers #if( $likeCount == 
1)likes#{else}like#end this. $dislikeCount people dislike this.</td>
			#else
    		<td><span class="liked"><strong><a class="confluence-userlink username:${req.userPrincipal.name} url fn" href="$req.contextPath/display/~${req.userPrincipal.name}">You</a></strong> and <a id="likeUserTip" href="#" title="Click to expand">$likeCount #if( $likeCount == 1)other#{else}others#end</a><span id="likeUserList" style="display: none">$likeUserList</span> like this. $dislikeCount people dislike this.</span></td>
			#end

		</tr>
	</table>
</div>

#requireResource("confluence.web.resources:jquery")

<!-- Init -->
<script type="text/javascript">
    var $j = jQuery.noConflict();

    $j(document).ready( function() {
        // Feedback Status
        var feedbackStatus = {};
		// Attach showing the list of likers
		$j("#likeUserTip").click( function () {
			$j("#likeUserTip").fadeOut();
			$j("#likeUserList").fadeIn();
			return false;
		} ); 
		
        // Attach feedback triggers to images
        $j("div.helpful.unranked a").click( function () {
            // Was helpful clicked?
            var useful = $j("img", this)[0].alt == "yes";
            $j("div.helpful.unranked div.feedback input.useful")[0].value = useful ? "true" : "false";
            // Grab the div
            var feedbackDiv = $j("div.helpful.unranked div.feedback");
            // What to actually do
            var displayFeedbackForm = function () {
                // Colour the feedback div and show it
                feedbackDiv.css('border-color', useful ? '#009900' : '#CC0000');
                feedbackDiv.css('background-color', useful ? '#ddffdd' : '#FFCCCC');
                if (feedbackStatus.clicked) feedbackDiv.fadeIn(); else feedbackDiv.slideDown();
                feedbackStatus.helpful = useful;
                feedbackStatus.clicked = true;
            }
            // Am I already showing?
			/*
            if (feedbackStatus.clicked) {
                if (feedbackStatus.helpful != useful) feedbackDiv.fadeOut("normal", displayFeedbackForm);
            } else displayFeedbackForm();
			*/
            // Stop the default action
            // return false;
        } );
        // Attach cancel trigger
        $j("div.helpful.unranked div.feedback div.buttons input.cancel").click( function () {
            $j("div.helpful.unranked div.feedback").slideUp("normal", function () {
                feedbackStatus.clicked = false;
            });
        } );
    } );
</script>
